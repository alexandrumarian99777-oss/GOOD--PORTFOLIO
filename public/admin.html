<table id="messages-table">
  <thead>
    <tr>
      <th>Name</th>
      <th>Email</th>
      <th>Message</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
async function fetchMessages() {
  const res = await fetch('/admin/messages');
  const data = await res.json();
  if (!data.success) return alert(data.error);

  const tbody = document.querySelector('#messages-table tbody');
  tbody.innerHTML = '';

  data.messages.forEach(msg => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${msg.name}</td>
      <td>${msg.email}</td>
      <td>${msg.message}</td>
      <td><button data-id="${msg._id}">Delete</button></td>
    `;
    tbody.appendChild(tr);
  });

  document.querySelectorAll('button[data-id]').forEach(btn => {
    btn.addEventListener('click', async () => {
      const id = btn.getAttribute('data-id');
      if (!confirm('Are you sure you want to delete this message?')) return;

      const res = await fetch('/admin/messages/' + id, { method: 'DELETE' });
      const result = await res.json();
      if (result.success) {
        alert('✅ Message deleted');
        fetchMessages(); // refresh list
      } else {
        alert('❌ ' + result.error);
      }
    });
  });
}

fetchMessages();
</script>
